USE ROLE ARL_ACTUARIAL_POWERUSER;
CREATE SCHEMA IF NOT EXISTS STC;
USE ACTUARIAL_ILS_POC.STC;

CREATE OR REPLACE TABLE STC.CALCULATION_HEADER CLUSTER BY (CALCULATIONID) (
    CALCULATIONID NUMBER(38,0) NOT NULL,
    CALCULATIONNAME VARCHAR(255) NOT NULL,
    CONDITIONAL_CUTOFF_DATE  TIMESTAMP_NTZ(7) NOT NULL,
    ACCTGPERIOD NUMBER(38,0) NOT NULL,
    ASATDATE TIMESTAMP_NTZ(7) NOT NULL,
    USEBOUNDFX BOOLEAN NOT NULL,
    BASECURRENCY CHAR(3) NOT NULL,
    CURRENTFXDATE TIMESTAMP_NTZ(7) NULL,
    CREATEDATE TIMESTAMP_NTZ(7) NOT NULL,
    CONSTRAINT CALCULATION_HEADER_PK PRIMARY KEY (CALCULATIONID),
    CONSTRAINT CALCULATION_HEADER_UK UNIQUE (CALCULATIONNAME, CONDITIONAL_CUTOFF_DATE, ASATDATE, ACCTGPERIOD, CREATEDATE)
);


CREATE OR REPLACE TABLE STC.LAYER_ITD_METRICS CLUSTER BY (CALCULATIONID, MASTERKEY, MASTERKEYFROM) (
    CALCULATIONID NUMBER(38,0) NOT NULL,
    MASTERKEY VARCHAR(50) NOT NULL,
    MASTERKEYFROM VARCHAR(20) NOT NULL,
    LAYERID NUMBER(38,0) NOT NULL,
    SUBMISSIONID NUMBER(38,0) NOT NULL,
    ISMULTIYEAR BOOLEAN NOT NULL,
    ISCANCELLABLE BOOLEAN NOT NULL,
    UWYEAR NUMBER(38,0) NOT NULL,
    SEGMENT VARCHAR(2) NOT NULL,
    PERSPECTIVETYPE VARCHAR(50) NOT NULL,
    CURRENCY VARCHAR(16) NOT NULL,
    FACILITY VARCHAR(3) NOT NULL,
    ARCHCONTRACTLIMIT NUMBER(18, 2) NOT NULL,
    ARCHAGGLIMIT NUMBER(18, 2) NOT NULL,
    RETENTION NUMBER(18, 2) NOT NULL,
    WP NUMBER(18, 2) NOT NULL,
    WPxRP NUMBER(18, 2) NOT NULL,
    RP NUMBER(18, 2) NOT NULL,
    ULT_LOSS NUMBER(22, 6) NOT NULL,
    LIMITPCTUSED NUMBER(18, 10) NOT NULL,
    CONSTRAINT LAYER_ITD_METRICS_PK PRIMARY KEY (CALCULATIONID, MASTERKEY, MASTERKEYFROM),
    CONSTRAINT LAYER_ITD_METRICS_CALCULATION_HEADER_CALCULATIONID_FK FOREIGN KEY (CALCULATIONID) REFERENCES STC.CALCULATION_HEADER(CALCULATIONID)     
);


CREATE OR REPLACE TABLE STC.LAYERYELT_ORIGINAL CLUSTER BY (CALCULATIONID, LAYERID, LOSSVIEW)(
    CALCULATIONID NUMBER(38,0) NOT NULL,
    LAYERLOSSANALYSISID NUMBER(38,0) NOT NULL,
	LOSSANALYSISID NUMBER(38,0) NOT NULL,
    GUANALYSISID NUMBER(38,0) NOT NULL,
    LOSSVIEW VARCHAR(100) NOT NULL,
	LAYERID NUMBER(38,0) NOT NULL,
    LAYERINCEPTION DATE NOT NULL,
    LAYEREXPIRATION DATE NOT NULL,
    CONDITIONALDATE DATE NOT NULL,
	EVENTID NUMBER(38,0) NOT NULL,
	PERIL VARCHAR(50) NOT NULL,
	YEAR NUMBER(38,0) NOT NULL,
	DAY NUMBER(38,0) NOT NULL,
    EVENTDATE DATE NOT NULL,
    CURRENCY CHAR(3) NOT NULL,
	LOSSPCT FLOAT NOT NULL,
	RPPCT FLOAT NOT NULL,
	RBPCT FLOAT NOT NULL,
    LOSS FLOAT NOT NULL,
    RP FLOAT NOT NULL,
	RB FLOAT NOT NULL,
    LAYERLOSSANALYSISROWVERSION BINARY(16) NOT NULL,
    CONSTRAINT LAYERYELT_ORIGINAL_PK PRIMARY KEY (CALCULATIONID, LAYERID, LOSSVIEW),    
    CONSTRAINT LAYERYELT_ORIGINAL_HEADER_CALCULATIONID_FK FOREIGN KEY (CALCULATIONID) REFERENCES STC.CALCULATION_HEADER(CALCULATIONID)
);

CREATE OR REPLACE TABLE STC.LAYERYELT_RECALCULATED CLUSTER BY (CALCULATIONID, LAYERID, LOSSVIEW)(
    CALCULATIONID NUMBER(38,0) NOT NULL,
    LAYERLOSSANALYSISID NUMBER(38,0) NOT NULL,
	LOSSANALYSISID NUMBER(38,0) NOT NULL,
    GUANALYSISID NUMBER(38,0) NOT NULL,
    LOSSVIEW VARCHAR(100) NOT NULL,
	LAYERID NUMBER(38,0) NOT NULL,
    LAYERINCEPTION DATE NOT NULL,
    LAYEREXPIRATION DATE NOT NULL,
    CONDITIONALDATE DATE NOT NULL,
	EVENTID NUMBER(38,0) NOT NULL,
	PERIL VARCHAR(50) NOT NULL,
	YEAR NUMBER(38,0) NOT NULL,
	DAY NUMBER(38,0) NOT NULL,
    EVENTDATE DATE NOT NULL,
    CURRENCY CHAR(3) NOT NULL,
	LOSSPCT FLOAT NOT NULL,
	RPPCT FLOAT NOT NULL,
	RBPCT FLOAT NOT NULL,
    LOSS FLOAT NOT NULL,
    RP FLOAT NOT NULL,
	RB FLOAT NOT NULL,
    LAYERLOSSANALYSISROWVERSION BINARY(16) NOT NULL,
    CONSTRAINT LAYERYELT_RECALCULATED_PK PRIMARY KEY (CALCULATIONID, LAYERID, LOSSVIEW),    
    CONSTRAINT LAYERYELT_RECALCULATED_HEADER_CALCULATIONID_FK FOREIGN KEY (CALCULATIONID) REFERENCES STC.CALCULATION_HEADER(CALCULATIONID)
);
CREATE OR REPLACE TABLE STC.LAYERYELT_CONDITIONAL CLUSTER BY (CALCULATIONID, LAYERID, LOSSVIEW)(
    CALCULATIONID NUMBER(38,0) NOT NULL,
    LAYERLOSSANALYSISID NUMBER(38,0) NOT NULL,
	LOSSANALYSISID NUMBER(38,0) NOT NULL,
    GUANALYSISID NUMBER(38,0) NOT NULL,
    LOSSVIEW VARCHAR(100) NOT NULL,
	LAYERID NUMBER(38,0) NOT NULL,
    LAYERINCEPTION DATE NOT NULL,
    LAYEREXPIRATION DATE NOT NULL,
    CONDITIONALDATE DATE NOT NULL,
	EVENTID NUMBER(38,0) NOT NULL,
	PERIL VARCHAR(50) NOT NULL,
	YEAR NUMBER(38,0) NOT NULL,
	DAY NUMBER(38,0) NOT NULL,
    EVENTDATE DATE NOT NULL,
    CURRENCY CHAR(3) NOT NULL,
	LOSSPCT FLOAT NOT NULL,
	RPPCT FLOAT NOT NULL,
	RBPCT FLOAT NOT NULL,
    LOSS FLOAT NOT NULL,
    RP FLOAT NOT NULL,
	RB FLOAT NOT NULL,
    LAYERLOSSANALYSISROWVERSION NUMBER(38,0) NOT NULL,
    CONSTRAINT LAYERYELT_CONDITIONAL_PK PRIMARY KEY (CALCULATIONID, LAYERID, LOSSVIEW),    
    CONSTRAINT LAYERYELT_CONDITIONAL_HEADER_CALCULATIONID_FK FOREIGN KEY (CALCULATIONID) REFERENCES STC.CALCULATION_HEADER(CALCULATIONID)
);

CREATE OR REPLACE TABLE STC.RETRO_CESSION CLUSTER BY (CALCULATIONID, RETROPROGRAMID)(
    CALCULATIONID NUMBER(38,0) NOT NULL,
    RETROLEVEL NUMBER(38,0) NOT NULL,
	RETROPROGRAMID NUMBER(38,0) NOT NULL,
    RETROPROGRAMTYPE CHAR(3) NOT NULL,
    RESETTYPE CHAR(3) NOT NULL,
    RETROINCEPTION DATE NOT NULL,
    RETROEXPIRATION DATE NOT NULL,
    CURRENCY CHAR(3) NOT NULL,
	SUBJECTPREMIUM FLOAT NOT NULL,
    SUBJECTPREMIUMPLACED FLOAT NOT NULL,
    CEDEDPREMIUM FLOAT NOT NULL,
    SUBJECTLIMIT FLOAT NOT NULL,
    SUBJECTLIMITPLACED FLOAT NOT NULL,
    CEDEDLIMIT FLOAT NOT NULL,
    CONSTRAINT RETRO_CESSION_PK PRIMARY KEY (CALCULATIONID, RETROPROGRAMID),    
    CONSTRAINT RETRO_CESSION_CALCULATIONID_FK FOREIGN KEY (CALCULATIONID) REFERENCES STC.CALCULATION_HEADER(CALCULATIONID)
);


CREATE OR REPLACE TABLE STC.RETRO_LAYER_PERIOD_CESSION CLUSTER BY (CALCULATIONID, RETROPROGRAMID, LAYERID, CESSIONSTARTDATEINCLUSIVE, CESSIONENDDATEEXCLUSIVE)(
    CALCULATIONID NUMBER(38,0) NOT NULL,
    RETROLEVEL NUMBER(38,0) NOT NULL,
	RETROPROGRAMID NUMBER(38,0) NOT NULL,
    RETROPROGRAMTYPE CHAR(3) NOT NULL,
    RESETTYPE CHAR(3) NOT NULL,
    RETROINCEPTION DATE NOT NULL,
    RETROEXPIRATION DATE NOT NULL,
	LAYERID NUMBER(38,0) NOT NULL,
    LAYERINCEPTION DATE NOT NULL,
    LAYEREXPIRATION DATE NOT NULL,
    LAYERSTATUS VARCHAR(100) NOT NULL,
    CESSIONSTARTDATEINCLUSIVE DATE NOT NULL,
	CESSIONENDDATEEXCLUSIVE DATE NOT NULL,
	CURRENCY CHAR(3) NOT NULL,
    RETROPLACEMENT NUMBER(18, 10) NOT NULL,
    DEPOSITPREMIUM FLOAT NOT NULL,
	SUBJECTPREMIUM FLOAT NOT NULL,
    SUBJECTPREMIUMPLACED FLOAT NOT NULL,
    CEDEDPREMIUM FLOAT NOT NULL,
    DEPOSITLIMIT FLOAT NOT NULL,
    SUBJECTLIMIT FLOAT NOT NULL,
    SUBJECTLIMITPLACED FLOAT NOT NULL,
    CEDEDLIMIT FLOAT NOT NULL,
    GROSSCESSIONAFTERPLACEMENT FLOAT NOT NULL,
    NETCESSION FLOAT NOT NULL,
    CONSTRAINT RETRO_LAYER_PERIOD_CESSION_PK PRIMARY KEY (CALCULATIONID, RETROPROGRAMID, LAYERID, CESSIONSTARTDATEINCLUSIVE, CESSIONENDDATEEXCLUSIVE),    
    CONSTRAINT RETRO_LAYER_PERIOD_CESSION_CALCULATIONID_FK FOREIGN KEY (CALCULATIONID) REFERENCES STC.CALCULATION_HEADER(CALCULATIONID)
);